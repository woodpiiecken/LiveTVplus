<?php
session_start();
$erro = '';

if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    $usuario = $_POST['usuario'];
    $senha = $_POST['senha'];
    
    // Conectar ao banco
    $conn = new mysqli('localhost', 'usuario', 'senha', 'seu_banco');
    
    $stmt = $conn->prepare("SELECT * FROM usuarios_acesso WHERE usuario = ? AND senha = ? AND ativo = 1");
    $stmt->bind_param("ss", $usuario, $senha);
    $stmt->execute();
    $result = $stmt->get_result();
    
    if ($result->num_rows > 0) {
        $user = $result->fetch_assoc();
        
        // Verificar 1 dispositivo
        $dispositivo_id = md5($_SERVER['HTTP_USER_AGENT'] . $_SERVER['REMOTE_ADDR']);
        
        if ($user['dispositivo_id'] && $user['dispositivo_id'] != $dispositivo_id) {
            $erro = "Conta já está em uso em outro dispositivo.";
        } else {
            // Registrar dispositivo
            $conn->query("UPDATE usuarios_acesso SET dispositivo_id = '$dispositivo_id', acessos = acessos + 1, ip_acesso = '{$_SERVER['REMOTE_ADDR']}' WHERE id = {$user['id']}");
            
            $_SESSION['usuario_id'] = $user['id'];
            $_SESSION['produto'] = $user['produto_id'];
            
            // Redirecionar para a live
            header("Location: https://www.youtube.com/embed/CODIGO_DA_LIVE?autoplay=1");
            exit;
        }
    } else {
        $erro = "Usuário ou senha inválidos.";
    }
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>Acesso à Live</title>
</head>
<body>
    <h2>Login - Acesso Exclusivo</h2>
    <?php if ($erro) echo "<p style='color:red'>$erro</p>"; ?>
    <form method="POST">
        <input type="text" name="usuario" placeholder="Usuário" required><br>
        <input type="password" name="senha" placeholder="Senha" required><br>
        <button type="submit">Entrar na Live</button>
    </form>
</body>
</html>